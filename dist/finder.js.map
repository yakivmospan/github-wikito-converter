{"version":3,"sources":["../src/finder.js"],"names":[],"mappings":"AAAA,YAAY,CAAA;;;;;;AAEZ,IAAI,GAAG,GAAG,OAAO,CAAC,UAAU,CAAC;IACzB,IAAI,GAAG,OAAO,CAAC,MAAM,CAAC;IACtB,EAAE,GAAG,OAAO,CAAC,UAAU,CAAC;IACxB,IAAI,GAAG,OAAO,CAAC,MAAM,CAAC;IACtB,MAAM,GAAG,OAAO,CAAC,UAAU,CAAC;IAC5B,OAAO,GAAG,OAAO,CAAC,UAAU,CAAC,CAAA;;;;;;IAK3B,MAAM;WAAN,MAAM;0BAAN,MAAM;;;eAAN,MAAM;;;;;;;;;WAQgB,6BAAC,QAAQ,EAAE;;AAEnC,aAAO,IAAI,OAAO,CAAC,UAAS,OAAO,EAAE,MAAM,EAAE;;AAE3C,YAAI,OAAO,GAAG,EAAE;YACZ,OAAO,GAAG,EAAE;YACZ,OAAO,GAAG,EAAE,KAAK,EAAE,KAAK,EAAE,OAAO,EAAE,IAAI,EAAE,CAAA;;AAE7C,WAAG,CAAC,SAAS,CAAC,QAAQ,EAAE,OAAO,EAAE,UAAU,GAAG,EAAE,OAAO,EAAE,QAAQ,EAAE,IAAI,EAAE;AACrE,cAAI,CAAC,GAAG,EAAE;AACR,mBAAO,CAAC,QAAQ,CAAC,GAAG,OAAO,CAAA;AAC3B,gBAAI,IAAI,GAAG,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAA;AAClC,mBAAO,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,EAAE,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,GAAG,QAAQ,CAAA;WACpD;AACD,cAAI,EAAE,CAAA;SACP,EACD,UAAU,GAAG,EAAE,KAAK,EAAE;AACpB,cAAI,GAAG,EAAE;AACP,mBAAO,MAAM,CAAC,GAAG,CAAC,CAAA;WACnB;AACD,gBAAM,CAAC,KAAK,CACV,IAAI,CAAC,MAAM,CACT,8DAA8D,EAC9D,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,MAAM,EAC3B,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,MAAM,CAC5B,CACF,CAAA;AACD,iBAAO,CAAC,EAAC,KAAK,EAAE,OAAO,EAAE,OAAO,EAAE,OAAO,EAAC,CAAC,CAAA;SAC5C,CAAC,CAAA;OACL,CAAC,CAAA;KACH;;;;;;;;;WAOmB,uBAAC,KAAK,EAAE,WAAW,EAAE;AACvC,UAAI,IAAI,GAAG,IAAI,CAAA;AACf,WAAK,CAAC,IAAI,CAAC,UAAA,CAAC,EAAI;AACd,YAAI,CAAC,GAAG,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE,CAAC,CAAC,CAAA;AACjC,YAAI;AACF,iBAAQ,EAAE,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,MAAM,EAAE,KAAK,IAAI,GAAG,CAAC,CAAA,AAAC,CAAC;SAC/C,CAAC,OAAM,CAAC,EAAE;AACT,iBAAO,KAAK,CAAA;SACb;OACF,EAAE,IAAI,CAAC,CAAA;AACR,aAAO,IAAI,CAAA;KACZ;;;SAxDG,MAAM;;;AA2DZ,MAAM,CAAC,OAAO,GAAG,MAAM,CAAA","file":"finder.js","sourcesContent":["\"use strict\"\r\n\r\nvar dir = require('node-dir')\r\n  , path = require('path')\r\n  , fs = require('fs-extra')\r\n  , util = require('util')\r\n  , logger = require('./logger')\r\n  , Promise = require(\"bluebird\")\r\n\r\n/**\r\n * Finder class\r\n */\r\nclass Finder {\r\n\r\n  /**\r\n   * Search for md files\r\n   *\r\n   * @param {string} wikiPath Path to wiki directory\r\n   * @returns {Promise}\r\n   */\r\n  static searchMarkdownFiles(wikiPath) {\r\n\r\n    return new Promise(function(resolve, reject) {\r\n\r\n      var mdFiles = {},\r\n          aliases = {},\r\n          dirOpts = { match: /.md/, exclude: /^_/ }\r\n\r\n      dir.readFiles(wikiPath, dirOpts, function (err, content, filename, next) {\r\n          if (!err) {\r\n            mdFiles[filename] = content\r\n            var base = path.basename(filename)\r\n            aliases[base.substr(0, base.length - 3)] = filename\r\n          }\r\n          next()\r\n        },\r\n        function (err, files) {\r\n          if (err) {\r\n            return reject(err)\r\n          }\r\n          logger.debug(\r\n            util.format(\r\n              'Found %d markdown files and %d links pointing to them in TOC',\r\n              Object.keys(mdFiles).length,\r\n              Object.keys(aliases).length\r\n            )\r\n          )\r\n          resolve({files: mdFiles, aliases: aliases})\r\n        })\r\n    })\r\n  }\r\n\r\n  /**\r\n   * Search for a file among multiple directories, ordered by priority\r\n   *\r\n   * @returns {string|null}\r\n   */\r\n  static searchForFile(files, search_path) {\r\n    var file = null\r\n    files.some(f => {\r\n      var p = path.join(search_path, f)\r\n      try {\r\n        return (fs.statSync(p).isFile() && (file = p))\r\n      } catch(e) {\r\n        return false\r\n      }\r\n    }, this)\r\n    return file\r\n  }\r\n}\r\n\r\nmodule.exports = Finder\r\n"]}