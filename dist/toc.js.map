{"version":3,"sources":["../src/toc.js"],"names":[],"mappings":"AAAA,YAAY,CAAA;;;;;;AAEZ,IAAI,IAAI,GAAG,OAAO,CAAC,MAAM,CAAC;IACtB,EAAE,GAAG,OAAO,CAAC,UAAU,CAAC;IACxB,IAAI,GAAG,OAAO,CAAC,MAAM,CAAC;IACtB,MAAM,GAAG,OAAO,CAAC,QAAQ,CAAC,CAAA;;IAExB,GAAG;;;;;;;AAMI,WANP,GAAG,CAMK,EAAE,EAAE;0BANZ,GAAG;;AAOL,QAAI,CAAC,EAAE,GAAG,EAAE,CAAA;AACZ,QAAI,CAAC,eAAe,EAAE,CAAA;GACvB;;eATG,GAAG;;WAWI,uBAAG;AACZ,aAAO,IAAI,CAAC,KAAK,CAAA;KAClB;;;WAEM,mBAAG;AACR,aAAO,IAAI,CAAC,OAAO,CAAA;KACpB;;;WAEO,oBAAG;AACT,aAAO,IAAI,CAAC,QAAQ,CAAA;KACrB;;;;;;;WAMc,2BAAG;AAChB,UAAI,CAAC,KAAK,GAAG,IAAI,CAAC,kBAAkB,EAAE,CAAA;AACtC,UAAI,CAAC,OAAO,GAAG,IAAI,CAAC,EAAE,CAAC,oBAAoB,EAAE,CAAC,wBAAwB,CAAC,IAAI,CAAC,KAAK,CAAC,CAAA;AAClF,UAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,YAAY,EAAE,CAAA;KACpC;;;;;;;;WAMiB,8BAAG;AACnB,UAAI,OAAO,GAAG,IAAI,CAAC,EAAE,CAAC,UAAU,EAAE,CAAA;AAClC,UAAI,OAAO,EAAE;AACX,eAAO,EAAE,CAAC,YAAY,CAAC,OAAO,EAAE,EAAC,QAAQ,EAAE,MAAM,EAAC,CAAC,CAAA;OACpD;;AAED,aAAO,IAAI,CAAC,kBAAkB,EAAE,CAAA;KACjC;;;;;;;;WAMiB,8BAAG;AACnB,aAAO,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,gBAAgB,EAAE,CAAC,CAAC,GAAG,CAAC,UAAA,QAAQ,EAAI;AAC7D,YAAI,QAAQ,GAAG,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAA;AACtC,eAAO,IAAI,CAAC,MAAM,CAAC,YAAY,EAAE,QAAQ,EAAE,QAAQ,CAAC,CAAA;OACrD,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAA;KACd;;;;;;;;WAMW,wBAAG;AACb,UAAI,IAAI,GAAG,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAA;AAClD,UAAI,KAAK,GAAG,EAAE,CAAA;;AAEd,UAAI,CAAC,OAAO,CAAC,oBAAoB,EAAE,UAAS,WAAW,EAAE,IAAI,EAAE;AAC7D,YAAI,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC,KAAK,KAAK,EAAE;AAC1C,cAAI,GAAG,IAAI,CAAC,MAAM,CAAC,CAAC,EAAE,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC,CAAA;SACvC;AACD,aAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAA;OACjB,CAAC,CAAA;AACF,aAAO,KAAK,CAAA;KACb;;;SAxEG,GAAG;;;AA4ET,MAAM,CAAC,OAAO,GAAG,GAAG,CAAA","file":"toc.js","sourcesContent":["\"use strict\"\n\nvar path = require('path')\n  , fs = require('fs-extra')\n  , util = require('util')\n  , marked = require('marked')\n\nclass Toc {\n\n  /**\n   *\n   * @param {GWC} gwc\n   */\n  constructor(ld) {\n    this.ld = ld\n    this.computeTocParts()\n  }\n\n  getMarkdown() {\n    return this.tocMd\n  }\n\n  getHtml() {\n    return this.tocHtml\n  }\n\n  getLinks() {\n    return this.tocLinks\n  }\n\n\n  /**\n   * @private\n   */\n  computeTocParts() {\n    this.tocMd = this.getTocFileContents()\n    this.tocHtml = this.ld.getMarkdownConverter().convertTocMarkdownString(this.tocMd)\n    this.tocLinks = this.extractLinks()\n  }\n\n  /**\n   * @private\n   * @returns {String}\n   */\n  getTocFileContents() {\n    var tocFile = this.ld.getTocFile()\n    if (tocFile) {\n      return fs.readFileSync(tocFile, {encoding: 'utf8'})\n    }\n    // if no toc file, generate contents from files\n    return this.genTocFileContents()\n  }\n\n  /**\n   * @private\n   * @returns {string}\n   */\n  genTocFileContents() {\n    return Object.keys(this.ld.getMarkdownFiles()).map(filename => {\n      var basename = path.basename(filename)\n      return util.format('- [%s](%s)', basename, basename)\n    }).join('\\n')\n  }\n\n  /**\n   * @private\n   * @returns {Array}\n   */\n  extractLinks() {\n    var html = marked.parser(marked.lexer(this.tocMd))\n    var links = []\n\n    html.replace(/<a href=\"([^\"]+)\"/g, function(all_pattern, link) {\n      if (link.substr(link.length - 3) === '.md') {\n        link = link.substr(0, link.length - 3)\n      }\n      links.push(link)\n    })\n    return links\n  }\n\n}\n\nmodule.exports = Toc\n"]}